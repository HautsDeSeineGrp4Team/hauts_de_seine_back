
name: Build and deploy to Staging 

on:
  push:
    branches:
      - staging  # Trigger sur la branche "staging"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Check out code
      uses: actions/checkout@v4

    #steps:
      #- uses: gacts/install-podman@v1
        #with:
        #  kind: unstable # `testing` by default
        #  qemu: true # `false` by default

    - run: podman version

    - name: login podman  
      uses: redhat-actions/podman-login@v1
      with:
        username: ${{ secrets.DOCKER_USERNAME }} 
        password: ${{ secrets.DOCKER_PASSWORD }}  
        registry: "docker.io"  

    - name: Build image with Podman
      run: |
        sudo podman build  -t wared2003/pcc:latest-linuxarm64 --platform linux/arm64 .  # Construire l'image avec Podman Ã  partir du Containerfile

    - name: Push image to Docker Hub
      run: |
        podman push ${{ secrets.DOCKER_USERNAME }}/my-image:latest  # Pousser l'image sur Docker Hub
